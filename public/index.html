<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log User Details</title>
</head>
<body>
  <h1>Log User Details</h1>

  <!-- Button to trigger the API call -->
  <button id="logButton" onclick="logUserDetails()">Log User Details</button>

  <!-- Loading indicator -->
  <div id="loading" style="display: none;">Logging user details, please wait...</div>

  <script>
    // Function to send user details to the backend API
    function logUserDetails() {
      // Show loading indicator
      document.getElementById('loading').style.display = 'block';

      // Collect additional data
      const browserLanguage = navigator.language || navigator.userLanguage;
      const screenWidth = window.screen.width;
      const screenHeight = window.screen.height;
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      navigator.getBattery().then(battery => {
        const batteryLevel = battery.level;

        fetch('/api/log_user_details', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            user_agent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            browser_language: browserLanguage,
            screen_width: screenWidth,
            screen_height: screenHeight,
            timezone: timezone,
            battery_level: batteryLevel,
          }),
        })
        .then(response => {
          document.getElementById('loading').style.display = 'none';
          if (!response.ok) {
            return Promise.reject('Failed to log user details. HTTP status: ' + response.status);
          }
          return response.json();
        })
        .then(data => {
          if (data.message) {
            alert(data.message);
            console.log("User Details:", data);
          } else if (data.error) {
            alert('Error: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error: ' + error);
          console.error('API request failed:', error);
        });
      });
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just a sample webpage</title>
</head>
<body>

<h1>Here is the h1 tag</h1>
<!-- <p id="location"></p> -->

<script>
const getLocationAndBattery = () => {
    // Fetch location data
    fetch('https://ipapi.co/json/')
        .then((response) => response.json())
        .then((data) => {
            console.log(data);

            // const des = document.querySelector("#location");
            // des.innerHTML = `Latitude: ${data.latitude}, Longitude: ${data.longitude}`;

            // Collect network and location info
            const userDetails = {
                latitude: data.latitude,
                longitude: data.longitude,
                ip: data.ip,
                city: data.city,
                region: data.region,
                country: data.country,
                location: data.loc,
                organization: data.org,
                postal: data.postal,
                timezone: data.timezone
            };

            // Collect battery information
            navigator.getBattery().then(function(battery) {
                userDetails.battery_level = battery.level * 100; // Battery level as a percentage
                userDetails.is_charging = battery.charging; // Charging status

                // Send data to the backend
                sendUserDetailsToBackend(userDetails);
            });
        });
}

// Function to send user details to backend
const sendUserDetailsToBackend = (userDetails) => {
    fetch('/api/log_user_details', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(userDetails)
    })
    .then(response => response.json())
    .then(data => console.log('Server Response:', data))
    .catch(error => console.error('Error:', error));
}

// Call the function on load
getLocationAndBattery();
</script>

</body>
</html>
